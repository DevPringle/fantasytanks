<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Cup - September 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
    <style>
        /* Material Icons fallback */
        .material-icons {
            font-family: 'Material Icons', 'Material Icons Outlined', sans-serif;
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: rgba(15, 20, 25, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 36px;
            width: auto;
            max-width: 220px;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.3));
        }

        .logo:hover img {
            transform: scale(1.05);
            filter: drop-shadow(0 0 30px rgba(0, 212, 255, 0.5));
        }

        .nav-menu {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-link {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 0;
        }

        .nav-link:hover {
            color: #00d4ff;
            transform: translateY(-2px);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #00d4ff, #00b8e6);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .auth-section {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .user-menu {
            position: relative;
        }

        .user-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .user-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(0, 212, 255, 0.5);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: rgba(15, 20, 25, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 0.5rem;
            min-width: 200px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeInDown 0.3s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .dropdown-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 0.5rem 0;
        }

        .sign-in-btn {
            padding: 0.8rem 2rem;
            background: linear-gradient(135deg, #00d4ff, #00b8e6);
            border: none;
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2);
        }

        .sign-in-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.4);
            background: linear-gradient(135deg, #00b8e6, #00d4ff);
        }

        .mobile-toggle {
            display: none;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        /* Tournament Header */
        .tournament-header {
            background: 
                radial-gradient(circle at 30% 20%, rgba(0, 212, 255, 0.15), transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(0, 184, 230, 0.1), transparent 50%),
                linear-gradient(135deg, rgba(0, 212, 255, 0.05), rgba(26, 35, 50, 0.2));
            padding: 3rem 0 2rem;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tournament-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.5;
        }

        .tournament-header-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .event-logo-col {
            flex: 0 0 auto;
            display: flex;
            align-items: flex-start;
        }

        .event-logo-col img {
            width: auto;
            height: 160px; /* default; JS will adjust */
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.2));
        }

        @media (max-width: 768px) {
            .event-logo-col { display: none; }
        }

        .tournament-info {
            flex: 1;
            min-width: 300px;
        }

        .tournament-breadcrumb {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tournament-breadcrumb a {
            color: #00d4ff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .tournament-breadcrumb a:hover {
            color: #ffffff;
        }

        .tournament-name {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #00d4ff 0%, #00b8e6 50%, #0099cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .tournament-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }

        .meta-icon {
            color: #00d4ff;
            font-size: 1.2rem;
        }

        .tournament-status-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .status-badge {
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.4);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.2);
            transition: all 0.3s ease;
        }

        .status-badge.locked {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
        }

        .cutoff-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            border: 1px solid rgba(255, 193, 7, 0.4);
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.2);
            animation: pulse 2s infinite;
        }

        .timer-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(255, 193, 7, 0.2);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 193, 7, 0.4);
            }
        }

        .fantasy-info {
            text-align: right;
        }

        .fantasy-stat {
            font-size: 2rem;
            font-weight: 800;
            color: #00d4ff;
            margin-bottom: 0.5rem;
        }

        .fantasy-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .roster-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .action-btn {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #00d4ff, #00b8e6);
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.2);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: none;
        }

        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(0, 212, 255, 0.5);
        }

        /* Tournament Navigation */
        .tournament-nav {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .tournament-nav-container {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tournament-nav-container::-webkit-scrollbar {
            display: none;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            list-style: none;
            min-width: max-content;
        }

        .nav-tab {
            padding: 1.2rem 2rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 3px solid transparent;
            position: relative;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: #00d4ff;
            border-bottom-color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
        }

        /* Main Content Area */
        .tournament-content {
            padding: 3rem 0;
            min-height: 60vh;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Overview Tab */
        .overview-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .overview-main {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2.5rem;
            backdrop-filter: blur(10px);
        }

        .overview-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-subtitle {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tournament-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 1rem;
        }

        .progress-section {
            margin-bottom: 2rem;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            background: linear-gradient(135deg, #00d4ff, #00b8e6);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .quick-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .quick-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00d4ff;
            display: block;
            margin-bottom: 0.5rem;
        }

        .quick-stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Top Teams List */
        .teams-list {
            list-style: none;
        }

        .team-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .team-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .team-rank {
            font-weight: 700;
            color: #00d4ff;
            min-width: 2rem;
        }

        .team-name {
            font-weight: 600;
            color: #ffffff;
        }

        .team-score {
            font-weight: 600;
            color: #00d4ff;
        }

        /* Recent Activity */
        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            color: #00d4ff;
            font-size: 1.2rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .activity-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }

        /* Match Day Selector */
        .match-day-selector {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .match-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .match-day-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .match-day-tabs {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .match-day-tab {
            padding: 0.6rem 1rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            min-width: 80px;
            text-align: center;
        }

        .match-day-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .match-day-tab.active {
            background: linear-gradient(135deg, #00d4ff, #00b8e6);
            border-color: #00d4ff;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .match-day-tab.locked {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #ef4444;
            cursor: not-allowed;
        }

        .match-day-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .roster-status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .roster-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
        }

        .roster-status-dot.incomplete {
            background: #ffc107;
        }

        .roster-status-dot.empty {
            background: #6b7280;
        }

        /* Players Tab Styles */
        .players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .players-filters {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            min-width: 120px;
        }

        .filter-select option {
            background: #1a2332;
            color: #ffffff;
        }

        .show-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .players-table-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }

        .players-table {
            width: 100%;
            border-collapse: collapse;
        }

        .players-table th {
            background: rgba(255, 255, 255, 0.08);
            padding: 1rem;
            text-align: left;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .players-table th.sortable {
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .players-table th.sortable:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #00d4ff;
        }

        .players-table th.action-column {
            width: 80px;
            text-align: center;
        }

        .sort-icon {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .players-table th.sortable.asc .sort-icon {
            transform: translateY(-50%) rotate(180deg);
            opacity: 1;
            color: #00d4ff;
        }

        .players-table th.sortable.desc .sort-icon {
            opacity: 1;
            color: #00d4ff;
        }

        .players-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .players-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .player-action-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            padding: 0.5rem;
            border-radius: 6px;
            cursor: not-allowed;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .player-action-btn.add {
            border-color: rgba(34, 197, 94, 0.5);
            color: #22c55e;
            cursor: pointer;
        }

        .player-action-btn.add:hover {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
            transform: scale(1.05);
        }

        .player-action-btn.remove {
            border-color: rgba(239, 68, 68, 0.5);
            color: #ef4444;
            cursor: pointer;
        }

        .player-action-btn.remove:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            transform: scale(1.05);
        }

        .player-name {
            font-weight: 600;
            color: #ffffff;
        }

        .player-team {
            font-weight: 600;
            color: #00d4ff;
        }

        .player-battles {
            color: rgba(255, 255, 255, 0.8);
        }

        .player-points {
            font-weight: 600;
            color: #00d4ff;
        }

        .player-avg {
            color: rgba(255, 255, 255, 0.8);
        }

        .player-picked {
            color: rgba(255, 255, 255, 0.7);
        }

        .roster-sidebar {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            z-index: 1000;
        }

        .roster-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .roster-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
            text-align: center;
        }

        .roster-status {
            text-align: center;
            color: #00d4ff;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .roster-message {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.5;
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .auth-message {
            background: rgba(15, 20, 25, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            color: #ffffff;
            backdrop-filter: blur(10px);
            max-width: 280px;
        }

        .auth-message h4 {
            color: #00d4ff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .auth-message p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .roster-list {
            display: none;
        }

        .roster-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .roster-player-name {
            color: #ffffff;
            font-weight: 500;
        }

        .roster-player-remove {
            background: transparent;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .roster-player-remove:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Standings Styles */
        .standings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .standings-filters {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .standings-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .standings-table th {
            background: rgba(255, 255, 255, 0.08);
            padding: 1rem;
            text-align: left;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .standings-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }

        .rank-cell {
            text-align: center;
            font-weight: 700;
            color: #00d4ff;
        }

        .username-cell {
            font-weight: 600;
            color: #ffffff;
        }

        .score-cell {
            text-align: right;
            font-weight: 600;
            color: #00d4ff;
        }

        .loading-state {
            text-align: center;
            padding: 3rem 2rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            background: rgba(15, 20, 25, 0.9);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 3rem 0 2rem;
            margin-top: 5rem;
            backdrop-filter: blur(20px);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .footer-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .footer-links a:hover {
            color: #00d4ff;
            transform: translateY(-2px);
        }

        .footer-note {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            text-align: center;
            max-width: 400px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .roster-sidebar {
                position: static;
                transform: none;
                width: 100%;
                margin-top: 2rem;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(15, 20, 25, 0.98);
                flex-direction: column;
                padding: 2rem;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .nav-menu.active {
                display: flex;
            }

            .mobile-toggle {
                display: block;
            }

            .tournament-name {
                font-size: 2rem;
            }

            .tournament-header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .overview-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .tournament-meta {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-tab {
                padding: 1rem 1.5rem;
                font-size: 0.9rem;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }

            .roster-actions {
                flex-direction: column;
            }

            .players-header {
                flex-direction: column;
                align-items: stretch;
            }

            .players-filters {
                justify-content: space-between;
            }

            .players-table-container {
                overflow-x: auto;
            }

            .players-table {
                min-width: 600px;
            }

            .players-table th,
            .players-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.85rem;
            }

            .match-day-tabs {
                justify-content: center;
                gap: 0.25rem;
            }

            .match-day-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
                min-width: 60px;
            }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .discord-sidebar {
            position: fixed;
            left: max(2rem, calc((100vw - 1400px) / 2 + 20px));
            top: 50%;
            transform: translateY(-50%);
            transform-origin: right center;
            width: 300px;
            z-index: 1000;
        }
        .discord-iframe {
            width: 100%;
            height: 380px;
            border: 0;
            border-radius: 12px;
            background: transparent;
        }
        @media (max-width: 1200px) {
            .discord-sidebar { display: none; }
        }

        .compact-card { padding: 1.25rem; }
        .compact-card .section-subtitle { margin-bottom: 0.5rem; }
        .compact-card .teams-list .team-item { padding: 0.75rem 0.75rem; }
        .compact-card .activity-list .activity-item { padding: 0.75rem 0; }
        .compact-card .discord-iframe { height: 320px; }
    </style>
</head>
<body>
    <header class="header" id="header">
        <nav class="nav container">
            <a href="index.html" class="logo">
                <img src="images/WotFan200x36.png" alt="Fantasy Tanks Logo">
            </a>
            
            <ul class="nav-menu" id="navMenu">
                <li><a href="tournaments.html" class="nav-link">Tournaments</a></li>
            </ul>

            <div class="auth-section">
                <div class="user-menu" id="userMenu" style="display: none;">
                    <button class="user-btn" onclick="toggleUserDropdown()">
                        <span class="material-icons">person</span>
                        <span id="username"></span>
                        <span class="material-icons">expand_more</span>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="#profile" class="dropdown-item">
                            <span class="material-icons">person</span>
                            Profile
                        </a>
                        <a href="#settings" class="dropdown-item">
                            <span class="material-icons">settings</span>
                            Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#logout" class="dropdown-item" onclick="handleLogout()">
                            <span class="material-icons">logout</span>
                            Sign Out
                        </a>
                    </div>
                </div>
                <button class="sign-in-btn" id="signInBtn" aria-label="Sign in to your account" onclick="redirectToLogin()">Sign In</button>
                <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle mobile menu">
                    <span class="material-icons">menu</span>
                </button>
            </div>
        </nav>
    </header>

    <main>
        <!-- Tournament Header -->
        <section class="tournament-header">
            <div class="container">
                <div class="tournament-header-content">
                    <div class="event-logo-col">
                        <img id="eventLogo" src="images/events/draft-cup-sept-2025-logo.png" alt="Draft Cup September 2025 Logo">
                    </div>
                    <div class="tournament-info">
                        <div class="tournament-breadcrumb">
                            <a href="tournaments.html">Tournaments</a>
                            <span class="material-icons" style="font-size: 1rem;">chevron_right</span>
                            <span>Draft Cup - September 2025</span>
                        </div>
                        
                        <h1 class="tournament-name" id="tournamentTitle">Draft Cup - September 2025</h1>
                        
                        <div class="tournament-meta">
                            <div class="meta-item">
                                <span class="material-icons meta-icon">public</span>
                                <span>North America</span>
                            </div>
                            <div class="meta-item">
                                <span class="material-icons meta-icon">groups</span>
                                <span>Pick 7 Players</span>
                            </div>
                            <div class="meta-item">
                                <span class="material-icons meta-icon">schedule</span>
                                <span>Ends: September 21, 2025</span>
                            </div>
                        </div>

                        <div class="tournament-status-header" id="statusHeader">
                            <span class="status-badge" id="rosterStatus">Rosters Open</span>
                            <div class="cutoff-timer" id="cutoffTimer" style="display: none;">
                                <span class="material-icons">schedule</span>
                                <span id="timeRemaining">96:00:00</span>
                            </div>
                        </div>

                        <div class="roster-actions">
                            <button class="action-btn">
                                <span class="material-icons">sports_esports</span>
                                Set My Roster
                            </button>
                            <button class="action-btn secondary">
                                <span class="material-icons">leaderboard</span>
                                View Leaderboard
                            </button>
                        </div>
                    </div>

                    <div class="fantasy-info">
                        <div class="fantasy-label">Fantasy Teams Competing</div>
                        <div class="fantasy-stat">0</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tournament Navigation -->
        <nav class="tournament-nav">
            <div class="container">
                <div class="tournament-nav-container">
                    <ul class="nav-tabs">
                        <li><a href="#overview" class="nav-tab active" data-tab="overview">
                            <span class="material-icons" style="font-size: 1rem;">home</span>
                            Overview
                        </a></li>
                        <li><a href="#schedule" class="nav-tab" data-tab="schedule">
                            <span class="material-icons" style="font-size: 1rem;">schedule</span>
                            Schedule
                        </a></li>
                        <li><a href="#standings" class="nav-tab" data-tab="standings">
                            <span class="material-icons" style="font-size: 1rem;">leaderboard</span>
                            Standings
                        </a></li>
                        <li><a href="#players" class="nav-tab" data-tab="players">
                            <span class="material-icons" style="font-size: 1rem;">people</span>
                            Players
                        </a></li>
                        <li><a href="#teams" class="nav-tab" data-tab="teams">
                            <span class="material-icons" style="font-size: 1rem;">groups</span>
                            Teams
                        </a></li>
                        <li><a href="#stats" class="nav-tab" data-tab="stats">
                            <span class="material-icons" style="font-size: 1rem;">analytics</span>
                            Stats
                        </a></li>
                    </ul>
                </div>
            </div>
        </nav>

<!-- Tournament Content -->
        <section class="tournament-content container">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="overview-grid">
                    <div class="overview-main">
                        <h2 class="section-title">
                            <span class="material-icons">info</span>
                            Tournament Information
                        </h2>
                        <p class="tournament-description">
                            In this draft style tournament, each team captain was given a fixed "budget" to build their team. Captains competed in multiple bidding rounds, allocating funds to secure the top players while balancing their overall roster.
                        </p>
                        <p class="tournament-description">
                            Every decision mattered. Overspend on a star player and risk leaving gaps elsewhere, or play it safe and hope your picks outperform expectations. This results in a competition where building your team on draft night is just as crucial as how you perform in game.
                        </p>
                        <p class="tournament-description">
                            Fantasy points are awarded based on real-time performance metrics including kills, damage dealt, damage assisted, damage blocked, accuracy, and overall team performance. Build your roster of 7 players strategically to maximize your fantasy points and climb the leaderboard against other fantasy teams.
                        </p>
                        <p class="tournament-description">
                            Allow this tournament to also serve as a tribute to AliceVonBully, a respected member of our community who left a lasting impact. The MVP of the tournament will receive the AliceVonBully MVP Award, celebrating not just excellence in play, but the enduring legacy of a player and friend. 
                        </p>
                        
                        <div class="progress-section">
                            <h3 class="section-subtitle">
                                <span class="material-icons">timeline</span>
                                Tournament Progress
                            </h3>
                            <div class="progress-label">
                                <span>Tournament Phase: Playoffs</span>
                                <span>75%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%;"></div>
                            </div>
                            <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; margin-top: 0.5rem;">
                                Teams are currently competing in playoffs. 
                            </p>
                        </div>

                        <div class="quick-stats">
                            <div class="quick-stat">
                                <span class="quick-stat-number">3</span>
                                <span class="quick-stat-label">Match Days</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-number">72</span>
                                <span class="quick-stat-label">Available Players</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-number">63</span>
                                <span class="quick-stat-label">Fantasy Teams</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-number">25</span>
                                <span class="quick-stat-label">Unique Matches</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-sidebar">
                        <div class="sidebar-card compact-card">
                            <h3 class="section-subtitle">
                                <span class="material-icons">emoji_events</span>
                                Top Fantasy Teams
                            </h3>
                            <ul class="teams-list">
                                <li class="team-item">
                                    <div class="team-info">
                                        <span class="team-rank">1</span>
                                        <span class="team-name"></span>
                                    </div>
                                    <span class="team-score"></span>
                                </li>
                                <li class="team-item">
                                    <div class="team-info">
                                        <span class="team-rank">2</span>
                                        <span class="team-name"></span>
                                    </div>
                                    <span class="team-score"></span>
                                </li>
                                <li class="team-item">
                                    <div class="team-info">
                                        <span class="team-rank">3</span>
                                        <span class="team-name"></span>
                                    </div>
                                    <span class="team-score"></span>
                                </li>
                            </ul>
                        </div>

                        <div class="sidebar-card compact-card">
                            <h3 class="section-subtitle">
                                <span class="material-icons">notifications</span>
                                Recent Activity
                            </h3>
                            <ul class="activity-list">
                                <li class="activity-item">
                                    <span class="material-icons activity-icon">schedule</span>
                                    <div class="activity-content">
                                        <div class="activity-text">Playoffs begins!</div>
                                        <div class="activity-time">Sep 21, 2025 - 8:00 PM</div>
                                    </div>
                                </li>
                                <li class="activity-item">
                                    <span class="material-icons activity-icon">swap_horiz</span>
                                    <div class="activity-content">
                                        <div class="activity-text"></div>
                                        <div class="activity-time">Sep 19, 2025 - 8:00 PM</div>
                                    </div>
                                </li>
                                <li class="activity-item">
                                    <span class="material-icons activity-icon">star</span>
                                    <div class="activity-content">
                                        <div class="activity-text"></div>
                                        <div class="activity-time">Sep 19, 2025 - 8:00 PM</div>
                                    </div>
                                </li>
                                <li class="activity-item">
                                    <span class="material-icons activity-icon">schedule</span>
                                    <div class="activity-content">
                                        <div class="activity-text">Groups play begins!</div>
                                        <div class="activity-time">Sep 19, 2025 - 8:00 PM</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="sidebar-card compact-card" id="discordSidebarCard">
                            <h3 class="section-subtitle">
                                <span class="material-icons">group</span>
                                Community Discord
                            </h3>
                            <iframe id="discordWidgetIframe" class="discord-iframe" title="Discord server widget" loading="lazy" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
                            <div id="discordWidgetStatus" style="margin-top:0.5rem; color: rgba(255,255,255,0.65); font-size: 0.85rem;"></div>
                            <a href="https://www.discord.gg/57teqfx9Yg" target="_blank" rel="noopener" class="action-btn secondary discord-join-btn" style="width: 100%; justify-content: center; margin-top: 1rem;">
                                <span class="material-icons">group_add</span>
                                Join Server
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Tab -->
            <div id="schedule" class="tab-content">
                <h2 class="section-title">
                    <span class="material-icons">schedule</span>
                    Tournament Schedule
                </h2>
                <div class="schedule-list">
                    <!-- MATCH DAY 1 -->
                    <div class="sidebar-card schedule-day-card" style="margin-bottom: 2rem;">
                        <h3 class="section-subtitle schedule-day-title" style="margin-bottom:1rem;">
                            <span class="material-icons">event</span>
                            Friday, September 19
                        </h3>
                        <table class="standings-table schedule-table" style="margin-bottom:0;">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Match</th>
                                    <th>Round</th>
                                    <th>Series Length</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="day1-matches">

                            </tbody>
                        </table>
                    </div>
                    <!-- MATCH DAY 2 -->
                    <div class="sidebar-card schedule-day-card" style="margin-bottom: 2rem;">
                        <h3 class="section-subtitle schedule-day-title" style="margin-bottom:1rem;">
                            <span class="material-icons">event</span>
                            Saturday, September 20
                        </h3>
                        <table class="standings-table schedule-table" style="margin-bottom:0;">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Match</th>
                                    <th>Round</th>
                                    <th>Series Length</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="day2-matches">

                            </tbody>
                        </table>
                    </div>
                    <!-- MATCH DAY 3 -->
                    <div class="sidebar-card schedule-day-card">
                        <h3 class="section-subtitle schedule-day-title" style="margin-bottom:1rem;">
                            <span class="material-icons">event</span>
                            Sunday, September 21
                        </h3>
                        <table class="standings-table schedule-table" style="margin-bottom:0;">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Match</th>
                                    <th>Round</th>
                                    <th>Series Length</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="day3-matches">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Standings Tab -->
            <div id="standings" class="tab-content">
                <div class="standings-header">
                    <h2 class="section-title">
                        <span class="material-icons">leaderboard</span>
                        Fantasy Leaderboard
                    </h2>
                    <div class="standings-filters">
                        <div class="filter-group">
                            <label for="standingsBracketFilter">View:</label>
                            <select id="standingsBracketFilter" class="filter-select">
                                <option value="">Overall Tournament</option>
                                <option value="match-day">Single Match Day</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="standingsMatchDayFilter">Match Day:</label>
                            <select id="standingsMatchDayFilter" class="filter-select">
                                <option value="">All Match Days</option>
                                <option value="1">Friday, September 19</option>
                                <option value="2">Saturday, September 20</option>
                                <option value="3">Sunday, September 21</option>
                            </select>
                        </div>
                        <button class="action-btn secondary">
                            <span class="material-icons">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>

                <div class="standings-container">
                    <div id="standingsLoadingState" class="loading-state">
                        <div class="loading-spinner"></div>
                        <div>Loading fantasy standings...</div>
                    </div>

                    <table class="standings-table" id="fantasyStandingsTable" style="display: none;">
                        <thead>
                            <tr>
                                <th class="rank-column">Rank</th>
                                <th class="name-column">Name</th>
                                <th class="score-column">Score</th>
                                <th class="avg-column">Avg. Score</th>
                                <th class="days-column" id="daysColumnHeader">Days</th>
                            </tr>
                        </thead>
                        <tbody id="fantasyStandingsTableBody">
                         
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Players Tab -->
            <div id="players" class="tab-content">
                <!-- Match Day Selector -->
                <div class="match-day-selector">
                    <div class="match-day-header">
                        <div class="match-day-title">
                            <span class="material-icons">event</span>
                            Select Match Day for Roster
                        </div>
                        <div class="roster-status-indicator">
                            <div class="roster-status-dot" id="currentRosterStatusDot"></div>
                            <span id="currentRosterStatusText">No roster set</span>
                        </div>
                    </div>
                    
                    <div class="match-day-tabs" id="matchDayTabs">
                        <button class="match-day-tab active" data-match-day="1">Friday, September 19</button>
                        <button class="match-day-tab" data-match-day="2">Saturday, September 20</button>
                        <button class="match-day-tab" data-match-day="3">Sunday, September 21</button>
                    </div>
                    
                    <div class="match-day-info">
                        <span id="matchDayDescription">Select a match day to set your roster for that specific tournament round.</span>
                        <span id="rosterDeadlineInfo"></span>
                    </div>
                </div>

                <div class="players-header">
                    <h2 class="section-title">
                        <span class="material-icons">people</span>
                        Fantasy Player Pool
                        <span id="currentMatchDayDisplay" style="color: #00d4ff; font-size: 1rem; margin-left: 1rem;">
                            (Match Day 1)
                        </span>
                    </h2>
                    <div class="players-filters">
                        <div class="filter-group">
                            <label for="teamFilter">Team:</label>
                            <select id="teamFilter" class="filter-select">
                                <option value="">All Teams</option>
                                <option value="ALEX">Bridge</option>
                                <option value="CHASE">TEAM</option>
                                <option value="TANKA">Underdogs</option>
                                <option value="HOCKE">Team Bye</option>
                                <option value="DAG">Dogs</option>
                                <option value="OP">Team O_P_HACKER</option>
                                <option value="MUSCL">Gym Class Zeros</option>
                                <option value="RNG">BASED</option>
                                <option value="OCTO">Banana</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <span class="show-label">SHOW</span>
                        </div>
                    </div>
                </div>

                <div class="players-table-container">
                    <table class="players-table">
                        <thead>
                            <tr>
                                <th class="action-column">Action</th>
                                <th class="sortable" data-sort="name">
                                    Name
                                    <span class="material-icons sort-icon">expand_more</span>
                                </th>
                                <th class="sortable" data-sort="team">
                                    Team
                                </th>
                                <th class="sortable" data-sort="battles">
                                    Battles
                                </th>
                                <th class="sortable" data-sort="points">
                                    Points
                                    <span class="material-icons sort-icon">expand_more</span>
                                </th>
                                <th class="sortable" data-sort="avg">
                                    Avg. Points
                                </th>
                                <th class="sortable" data-sort="picked">
                                    Picked By
                                </th>
                            </tr>
                        </thead>
                        <tbody id="playersTableBody">
                            <!-- Players populated by js -->
                        </tbody>
                    </table>
                </div>

                <div class="roster-sidebar">
                    <div class="roster-card">
                        <h3 class="roster-title">
                            Your Fantasy Roster
                            <div style="font-size: 0.9rem; font-weight: 500; color: #00d4ff; margin-top: 0.5rem;">
                                Match Day <span id="sidebarMatchDay">1</span>
                            </div>
                        </h3>
                        <div class="roster-status">
                            <span id="rosterCount">0</span>/7 Players Selected
                        </div>
                        <div class="roster-message" id="rosterMessage">
                            Your roster is empty. Add players from the table above to build your fantasy team.
                        </div>
                        <div class="roster-list" id="rosterList">
                            <!-- Selected players appear here -->
                        </div>
                        <div class="auth-overlay" id="authOverlay" style="display: none;">
                            <div class="auth-message">
                                <h4>Sign In Required</h4>
                                <p>Please sign in to start building your Fantasy Roster. Click the Sign In button in the top-right of the page.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teams Tab -->
            <div id="teams" class="tab-content">
              <h2 class="section-title">
                <span class="material-icons">groups</span>
                Team Rosters
              </h2>
              <div id="teamsContainer" class="teams-list-card-grid">

                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('alex')">
                    <img src="images/teams/BRIDGE.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Bridge</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-alex">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>__Alex</li>
                      <li>mrhood</li>
                      <li>Jedidieugh</li>
                      <li>Ruev</li>
                      <li>Simonfire13</li>
                      <li>Dragonwater</li>
                      <li>X_Abe</li>
                      <li>Sky_</li>
                    </ul>
                  </div>
                </div>
                  
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('chase')">
                    <img src="images/teams/TEAM.jpg" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Team</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-chase">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>Chase591</li>
                      <li>jacmac1210</li>
                      <li>JyRyster</li>
                      <li>_Press</li>
                      <li>_Gater</li>
                      <li>_Mitsua</li>
                      <li>AetherRNG</li>
                      <li>doctapat</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('tankarino')">
                    <img src="images/teams/UNDERDOGS.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Underdogs</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-tankarino">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>Tankarino</li>
                      <li>Kapahna</li>
                      <li>Kiwi_</li>
                      <li>gabriiel40</li>
                      <li>wotereq</li>
                      <li>External</li>
                      <li>Astatine</li>
                      <li>Pubmaxxer</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('hockey')">
                    <img src="images/teams/BYE.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Team Bye</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-hockey">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>HockeyGoalie</li>
                      <li>PM_Loves_Hoarce</li>
                      <li>Sadge</li>
                      <li>Zray</li>
                      <li>Dejdy</li>
                      <li>Reps</li>
                      <li>Loip123</li>
                      <li>Flounder__</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('o_p_hacker')">
                    <img src="images/teams/WoT-default.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Team O_P_Hacker</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-o_p_hacker">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>O_P_Hacker</li>
                      <li>Bolt_</li>
                      <li>PHARAOH_999</li>
                      <li>JhonJM</li>
                      <li>Lemisandrus</li>
                      <li>Maeril</li>
                      <li>_Ivory</li>
                      <li>_Deft</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('octobear')">
                    <img src="images/teams/BANANA.jpg" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Banana</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification">r</div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-octobear">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>Octobear</li>
                      <li>Aking_LTP</li>
                      <li>Sabo_Faceless</li>
                      <li>verwi</li>
                      <li>_Kookie</li>
                      <li>theincredulousk</li>
                      <li>Platinumdust</li>
                      <li>NightyWorg</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('muscles')">
                    <img src="images/teams/ZEROS.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Gym Class Zeros</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-muscles">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>Muscles1</li>
                      <li>thehobostrangle</li>
                      <li>_Leiwii</li>
                      <li>Seas_</li>
                      <li>Spirtwalker</li>
                      <li>____will</li>
                      <li>HelmetHead</li>
                      <li>EpicWin</li>
                    </ul>
                  </div>
                </div>
                
                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('rng')">
                    <img src="images/teams/WoT-default.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Based</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-rng">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>RNG</li>
                      <li>_Av1d</li>
                      <li>Loip</li>
                      <li>OBER</li>
                      <li>sprite1x</li>
                      <li>Crisis36</li>
                      <li>Paradox</li>
                      <li>_Tayloo</li>
                    </ul>
                  </div>
                </div>

                <div class="team-card">
                  <div class="team-header" onclick="toggleTeam('dagena')">
                    <img src="images/teams/DOGS.png" class="team-logo" alt="">
                    <div class="team-header-info">
                      <div class="team-title">Dogs</div>
                      <div class="team-region">North America</div>
                      <div class="team-qualification"></div>
                    </div>
                    <span class="material-icons team-expand-icon" id="expand-dagena">expand_more</span>
                  </div>
                  <div class="team-players-list">
                    <ul>
                      <li>Dagena</li>
                      <li>Obliterator154</li>
                      <li>SpaceAce</li>
                      <li>AglioPasta</li>
                      <li>Haasaka</li>
                      <li>MrSwindoll</li>
                      <li>DeIusion</li>
                      <li>_Kittzy</li>
                    </ul>
                  </div>
                </div>
                
              <style>
                .teams-list-card-grid {
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
                  gap: 2.5rem;
                  margin: 3rem 0 0;
                }
                .team-card {
                  background: rgba(255,255,255,0.08);
                  border: 1px solid rgba(255,255,255,0.09);
                  border-radius: 18px;
                  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
                  padding: 0;
                  margin:0;
                  overflow:hidden;
                  transition: box-shadow 0.23s, border-color 0.23s;
                }
                .team-card:hover {
                  box-shadow: 0 6px 28px rgba(0,212,255,0.13);
                  border-color: #00bdd5;
                }
                .team-header {
                  display: flex;
                  align-items: center;
                  gap: 1.75rem;
                  padding: 1.6rem 2rem;
                  cursor: pointer;
                  user-select: none;
                }
                .team-logo {
                  width: 54px;
                  height: 54px;
                  object-fit: contain;
                  border-radius: 0px;
                  box-shadow: 0 0px 0px rgba(0,212,255,0.10);
                  background: transparent;
                  flex-shrink:0;
                  margin-right:.5rem;
                  border: 0px solid rgba(0,212,255,0.13);
                }
                .team-header-info {
                  flex: 1;
                }
                .team-title {
                  font-weight: 700;
                  font-size: 1.5rem;
                  color: #fff;
                  margin-bottom: 0.25rem;
                }
                .team-region {
                  font-size: 1.06rem;
                  color: #00d4ff;
                  font-weight: 600;
                }
                .team-qualification {
                  color: rgba(255,255,255,0.7);
                  font-size:0.93rem;
                  margin-top: 0.11rem;
                }
                .team-expand-icon {
                  font-size: 2.75rem;
                  color: #00d4ff;
                  transition: transform 0.29s cubic-bezier(0.76,0,0.24,1);
                  margin-left: 0.75rem;
                }
                .team-card.open .team-expand-icon {
                  transform: rotate(180deg);
                }
                .team-players-list {
                  display: none;
                  background: rgba(20, 26, 37, 0.96);
                  border-top: 1px solid rgba(0,212,255,0.09);
                  padding: 1.4rem 2.2rem;
                  animation: fadeIn 0.27s ease;
                }
                .team-card.open .team-players-list {
                  display: block;
                }
                .team-players-list ul {
                  margin:0;
                  padding:0;
                  list-style:none;
                  columns: 2;
                  column-gap:2rem;
                  font-size:1.07rem;
                }
                .team-players-list li {
                  padding: 0.25rem 0.15rem;
                  color: #fff;
                  margin-bottom:3px;
                  border-radius: 4px;
                  font-weight: 500;
                }
              </style>
              <script>
                function toggleTeam(teamId) {
                  var card = document.querySelector('.team-card .team-header[onclick*="' + teamId + '"]').parentElement;
                  card.classList.toggle('open');
                  var expandIcon = document.getElementById('expand-'+teamId);
                  if (card.classList.contains('open')) {
                    expandIcon.textContent = 'expand_less';
                  } else {
                    expandIcon.textContent = 'expand_more';
                  }
                }
              </script>
            </div>

            <script>

                (function () {
                    const tournamentId = 'draft-cup-sept-2025';
                    const standingsTable = document.getElementById('fantasyStandingsTable');
                    const standingsBody = document.getElementById('fantasyStandingsTableBody');
                    const loadingState = document.getElementById('standingsLoadingState');
                    const bracketFilter = document.getElementById('standingsBracketFilter');
                    const matchDayFilter = document.getElementById('standingsMatchDayFilter');

                    function showLoading(show) {
                        loadingState.style.display = show ? 'block' : 'none';
                        standingsTable.style.display = show ? 'none' : 'table';
                    }

                    async function fetchAndRender() {
                        try {
                            showLoading(true);

                        const view = bracketFilter.value;
                        const daysHeader = document.getElementById('daysColumnHeader');
                        if (daysHeader) {
                            daysHeader.style.display = (view === 'match-day') ? 'none' : '';
                        }
                            const matchDayVal = matchDayFilter.value;

                            let data;
                            if (view === 'match-day' && matchDayVal) {
                                data = await api.getLeaderboard(tournamentId, parseInt(matchDayVal), 1);
                            } else {
                                // overall
                                data = await api.getLeaderboard(tournamentId, null, 1);
                            }

                            const leaderboard = (data && data.leaderboard) ? data.leaderboard : [];

                            // Clear table
                            standingsBody.innerHTML = '';

                            if (leaderboard.length === 0) {
                                standingsBody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: rgba(255,255,255,0.7);">No standings yet</td></tr>';
                                return;
                            }

                            // Render rows
                            for (const row of leaderboard) {
                                const tr = document.createElement('tr');

                                const rankTd = document.createElement('td');
                                rankTd.className = 'rank-cell';
                                rankTd.textContent = row.rank || '';

                                const nameTd = document.createElement('td');
                                nameTd.className = 'username-cell';
                                nameTd.textContent = row.username || row.user_id || 'Unknown';

                                const scoreTd = document.createElement('td');
                                scoreTd.className = 'score-cell';
                                scoreTd.textContent = (row.total_points != null) ? Number(row.total_points).toFixed(2) : '0.00';

                                const avgTd = document.createElement('td');
                                avgTd.className = 'avg-cell';
                                avgTd.textContent = (row.avg_points != null) ? Number(row.avg_points).toFixed(2) : '0.00';

                                const daysTd = document.createElement('td');
                                daysTd.className = 'days-cell';
                                daysTd.textContent = row.match_days_played != null ? row.match_days_played : '-';
                             
                                if (view === 'match-day') {
                                    daysTd.style.display = 'none';
                                }

                                tr.appendChild(rankTd);
                                tr.appendChild(nameTd);
                                tr.appendChild(scoreTd);
                                tr.appendChild(avgTd);
                                tr.appendChild(daysTd);

                                standingsBody.appendChild(tr);
                            }

                        } catch (err) {
                            console.error('Error loading standings:', err);
                            standingsBody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: rgba(255,255,255,0.7);">Error loading standings</td></tr>';
                        } finally {
                            showLoading(false);
                        }
                    }

                   
                    bracketFilter.addEventListener('change', () => {
                        // If selecting single match-day but no day chosen, default to 1
                        if (bracketFilter.value === 'match-day' && !matchDayFilter.value) {
                            matchDayFilter.value = '1';
                        }
                        fetchAndRender();
                    });

                    matchDayFilter.addEventListener('change', () => {
                        // if currently in overall view but user picks a specific day, don't auto-switch view
                        fetchAndRender();
                    });

                    // When the tab is clicked, refresh
                    document.querySelectorAll('.nav-tab').forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            const target = tab.getAttribute('data-tab');
                            if (target === 'standings') {
                                // give time for tab show
                                setTimeout(fetchAndRender, 100);
                            }
                        });
                    });

                    // initial load when page ready
                    document.addEventListener('DOMContentLoaded', () => {
                        // If standings tab is active on load, fetch immediately
                        const active = document.querySelector('.nav-tab.active');
                        if (active && active.getAttribute('data-tab') === 'standings') {
                            fetchAndRender();
                        }
                    });

                    // debugging
                    window._fantasyStandings = { fetchAndRender };
                })();
            </script>
            <!-- Stats Tab (modern rebuild) -->

            <div id="stats" class="tab-content">
                <h2 class="section-title">
                    <span class="material-icons">analytics</span>
                    Fantasy Statistics
                </h2>

                <div style="margin-bottom:1rem;">
                    <div style="background: linear-gradient(90deg, rgba(0,212,255,0.06), rgba(0,184,230,0.02)); border-left:4px solid #00d4ff; padding:0.75rem 1rem; border-radius:8px; color:#e8faff;">
                        <div style="font-weight:700; font-size:1rem;">Statistics compiled and provided by Mitsua</div>
                        <div style="margin-top:0.15rem; color:rgba(255,255,255,0.85); font-size:0.85rem;">Curated tournament performance data for player insight and event reporting.</div>
                    </div>
                </div>

                <div class="sidebar-card" style="padding: 1.25rem; margin-bottom: 1.5rem; display:flex; gap:1rem; align-items:center; justify-content:space-between; flex-wrap:wrap;">
                    <div style="min-width:220px;">
                        <div style="font-weight:600; color:#ffffff; margin-bottom:0.35rem;">Player statistics (CSV)</div>
                        <div style="color: rgba(255,255,255,0.7); font-size:0.9rem;">Loads <strong>StatsDraft4.csv</strong> from the repo root or upload a local CSV.</div>
                    </div>
                    <div style="display:flex; gap:0.5rem; align-items:center;">
                        <input id="statsCsvPath" type="text" value="StatsDraft4.csv" style="padding:0.45rem 0.7rem; border-radius:6px; background: rgba(255,255,255,0.04); color: #fff; border:1px solid rgba(255,255,255,0.06); min-width:260px;">
                        <button id="loadStatsBtn" class="action-btn secondary" style="padding:0.45rem 0.9rem;">Load CSV</button>
                        <input id="statsFileInput" type="file" accept="text/csv" style="display:none;">
                        <button id="chooseStatsFile" class="action-btn" style="padding:0.45rem 0.9rem;">Upload CSV</button>
                        <button id="clearStatsBtn" class="action-btn secondary" style="padding:0.45rem 0.9rem;">Clear</button>
                    </div>
                </div>

                <div class="standings-container" style="padding:0.5rem 0 1rem 0;">
                    <div id="statsLoadingState" class="loading-state" style="display:none; margin-bottom:0.75rem;">
                        <div class="loading-spinner"></div>
                        <div>Loading stats...</div>
                    </div>

                    <div id="statsTableWrapper" style="overflow:auto; background: rgba(255,255,255,0.02); border-radius:8px; padding:0.5rem;">
                        <table id="statsTable" class="standings-table" style="width:100%; display:none; border-collapse:separate; border-spacing:0 6px;">
                            <thead id="statsTableHead"></thead>
                            <tbody id="statsTableBody"></tbody>
                        </table>
                    </div>

                    <div id="statsPager" style="display:none; margin-top:0.75rem; display:flex; gap:0.5rem; align-items:center; justify-content:flex-end;">
                        <label style="color:rgba(255,255,255,0.8);">Rows:</label>
                        <select id="statsPageSize" style="padding:0.35rem; background: rgba(255,255,255,0.04); color:#fff; border:1px solid rgba(255,255,255,0.06);">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <button id="statsPrev" class="action-btn secondary" style="padding:0.35rem 0.6rem;">Prev</button>
                        <span id="statsPageInfo" style="color:rgba(255,255,255,0.8);">Page 1 / 1</span>
                        <button id="statsNext" class="action-btn secondary" style="padding:0.35rem 0.6rem;">Next</button>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

                <script>
                    (function(){
                        const csvInput = document.getElementById('statsFileInput');
                        const chooseFileBtn = document.getElementById('chooseStatsFile');
                        const loadBtn = document.getElementById('loadStatsBtn');
                        const clearBtn = document.getElementById('clearStatsBtn');
                        const pathInput = document.getElementById('statsCsvPath');
                        const loading = document.getElementById('statsLoadingState');
                        const table = document.getElementById('statsTable');
                        const thead = document.getElementById('statsTableHead');
                        const tbody = document.getElementById('statsTableBody');
                        const pager = document.getElementById('statsPager');
                        const pageSizeSelect = document.getElementById('statsPageSize');
                        const prevBtn = document.getElementById('statsPrev');
                        const nextBtn = document.getElementById('statsNext');
                        const pageInfo = document.getElementById('statsPageInfo');
                        const exportBtn = document.createElement('button');
                        exportBtn.id = 'statsExport';
                        exportBtn.className = 'action-btn';
                        exportBtn.style.padding = '0.35rem 0.6rem';
                        exportBtn.textContent = 'Export CSV';
                        pager.insertBefore(exportBtn, prevBtn);

                        let parsedData = null;
                        let rows = [];
                        let filteredRows = [];
                        let columnIsNumeric = [];
                        let columnDerivedValueFuncs = [];
                        let sortCol = -1; let sortDir = -1;
                        let filters = [];
                        let pageSize = Number(pageSizeSelect.value) || 25;
                        let pageIdx = 0;

                        function parseCSV(text) {
                            const res = Papa.parse(text, { skipEmptyLines: true });
                            if (!res || !res.data || !res.data.length) return { headers: [], rows: [] };
                            const headers = res.data[0].map(h => String(h || '').trim());
                            const rows = res.data.slice(1).map(r => r.map(c => c == null ? '' : String(c)));
                            return { headers, rows };
                        }

                        function detectNumericColumns(parsed) {
                            const h = parsed.headers.length;
                            const numeric = new Array(h).fill(false);
                            columnDerivedValueFuncs = new Array(h).fill(null);
                            const sample = Math.min(parsed.rows.length, 200);
                            for (let c=0;c<h;c++){
                                const head = String(parsed.headers[c]||'').toLowerCase();
                                if (/pen\s*hit/i.test(head) || head.indexOf('penhit')!==-1) {
                                    columnDerivedValueFuncs[c] = (v)=>{
                                        if (!v) return NaN; const m = String(v).trim().match(/^(\d+)\s*\/\s*(\d+)$/); if(!m) return NaN; const a=Number(m[1]), b=Number(m[2]); return b? a/b : NaN;
                                    };
                                    numeric[c]=false; continue;
                                }
                                let cnt=0; for (let r=0;r<sample;r++){ const v=parsed.rows[r][c]||''; const n=parseFloat(String(v).replace(/[ ,%$]/g,'')); if(!isNaN(n) && isFinite(n)) cnt++; }
                                numeric[c] = cnt >= Math.ceil(Math.max(1, sample*0.6));
                            }
                            return numeric;
                        }

                        function buildHeader(parsed){
                            thead.innerHTML='';
                            const row = document.createElement('tr');
                            parsed.headers.forEach((h, i)=>{
                                const th=document.createElement('th'); th.textContent=h; th.dataset.col=String(i); th.style.cursor='pointer';
                                const m=document.createElement('span'); m.className='sort-marker'; m.style.marginLeft='0.5rem'; m.style.opacity='0.7'; th.appendChild(m);
                                th.addEventListener('click', ()=>{ const col=Number(th.dataset.col); if(sortCol===col) sortDir=-sortDir; else{ sortCol=col; sortDir=-1;} applySortFilterRender(); });
                                if(columnIsNumeric[i]) th.style.textAlign='right'; row.appendChild(th);
                            }); thead.appendChild(row);
                            const frow=document.createElement('tr'); parsed.headers.forEach((h,i)=>{ const th=document.createElement('th'); const inp=document.createElement('input'); inp.type='text'; inp.style.width='100%'; inp.style.padding='0.35rem'; inp.style.background='rgba(255,255,255,0.02)'; inp.style.border='1px solid rgba(255,255,255,0.04)'; inp.style.color='#fff'; inp.addEventListener('input', e=>{ filters[i]=e.target.value.trim().toLowerCase(); pageIdx=0; applySortFilterRender(); }); th.appendChild(inp); if(columnIsNumeric[i]) th.style.textAlign='right'; frow.appendChild(th); }); thead.appendChild(frow);
                        }

                        function applyFilters(src){ if(!filters || filters.length===0) return src.slice(); return src.filter(r=>{ for(let c=0;c<parsedData.headers.length;c++){ const f=filters[c]; if(f && f.length){ const v=String(r[c]||'').toLowerCase(); if(!v.includes(f)) return false; }} return true; }); }

                        function applySort(src){ if(sortCol<0) return src; const col=sortCol; const isNum=columnIsNumeric[col]; const derived=columnDerivedValueFuncs[col]; return src.slice().sort((a,b)=>{ const va=a[col]!=null?String(a[col]).trim():''; const vb=b[col]!=null?String(b[col]).trim():''; if(derived){ const na=derived(va); const nb=derived(vb); const aNa=isNaN(na)||!isFinite(na); const bNa=isNaN(nb)||!isFinite(nb); if(aNa&&bNa) return 0; if(aNa) return 1*sortDir; if(bNa) return -1*sortDir; return (na-nb)*sortDir; } if(isNum){ const na=parseFloat(va.replace(/[ ,%$]/g,'')); const nb=parseFloat(vb.replace(/[ ,%$]/g,'')); if(isNaN(na)&&isNaN(nb)) return 0; if(isNaN(na)) return 1*sortDir; if(isNaN(nb)) return -1*sortDir; return (na-nb)*sortDir; } return va.localeCompare(vb)*sortDir; }); }

                        function renderPage(){ tbody.innerHTML=''; const total=filteredRows.length; const totalPages=Math.max(1, Math.ceil(total/pageSize)); if(pageIdx>=totalPages) pageIdx=totalPages-1; const start=pageIdx*pageSize; const end=Math.min(total, start+pageSize); for(let r=start;r<end;r++){ const row=filteredRows[r]; const tr=document.createElement('tr'); for(let c=0;c<parsedData.headers.length;c++){ const td=document.createElement('td'); const v=row[c]!=null?row[c]:''; td.textContent=v; if(columnIsNumeric[c]) td.style.textAlign='right'; tr.appendChild(td);} tbody.appendChild(tr);} table.style.display = parsedData && parsedData.headers.length ? '' : 'none'; pager.style.display = total===0? 'none' : ''; pageInfo.textContent = `Page ${pageIdx+1} / ${totalPages} (${total} rows)`; prevBtn.disabled = pageIdx===0; nextBtn.disabled = pageIdx>=totalPages-1; Array.from(thead.querySelectorAll('th')).forEach(th=>{ const idx=Number(th.dataset.col); const m=th.querySelector('.sort-marker'); if(!m) return; m.textContent = idx===sortCol ? (sortDir===-1? ' ':' ') : ''; }); }

                        function applySortFilterRender(){ filteredRows = applyFilters(rows); filteredRows = applySort(filteredRows); renderPage(); }

                        function initializeTable(parsed){ parsedData = parsed; rows = parsed.rows.map(r=>{ const arr=new Array(parsed.headers.length).fill(''); for(let i=0;i<parsed.headers.length;i++) arr[i] = r[i]!=null? r[i] : ''; return arr; }); const penIdx = parsed.headers.findIndex(h=>/pen\s*hit/i.test(h) || String(h).toLowerCase().indexOf('penhit')!==-1); if(penIdx!==-1){ const newH = parsed.headers.slice(); newH.splice(penIdx+1,0,'PenHit %'); parsedData.headers = newH; rows = rows.map(r=>{ const clone = r.slice(); const val=String(r[penIdx]||''); const m=val.trim().match(/^(\d+)\s*\/\s*(\d+)$/); const pct=(m&&Number(m[2])>0)? (Number(m[1])/Number(m[2])*100) : NaN; clone.splice(penIdx+1,0, isNaN(pct)? '': (Math.round(pct*10)/10) + '%'); return clone; }); }
                            filters = new Array(parsed.headers.length).fill(''); columnIsNumeric = detectNumericColumns(parsed); sortCol=-1; sortDir=-1; pageIdx=0; buildHeader(parsed); filteredRows = rows.slice(); pageSize = Number(pageSizeSelect.value)||25; renderPage(); }

                        async function attemptFetch(paths){ for(const p of paths){ try{ const r = await fetch(p); if(r && r.ok){ const text = await r.text(); return {text, used:p}; } }catch(e){} } return null; }

                        async function fetchAndLoad(path){ if(!path) return; loading.style.display='block'; try{ const encodeSegments = p=> p.split('/').map(s=>encodeURIComponent(s)).join('/'); const enc = encodeSegments(path); const candidates = [ path, `https://raw.githubusercontent.com/DevPringle/fantasytanks/main/${path}`, enc, `https://raw.githubusercontent.com/DevPringle/fantasytanks/main/${enc}` ]; const res = await attemptFetch(candidates); if(!res) throw new Error('Could not fetch CSV'); pathInput.value = res.used; const parsed = parseCSV(res.text); initializeTable(parsed); }catch(err){ alert('Error loading CSV. You can upload a file instead.'); console.error(err); } finally{ loading.style.display='none'; } }

                        loadBtn.addEventListener('click', ()=>{ const p = pathInput.value && pathInput.value.trim(); if(!p){ alert('Enter a path or upload a CSV file.'); return; } fetchAndLoad(p); });
                        chooseFileBtn.addEventListener('click', ()=> csvInput.click());
                        clearBtn.addEventListener('click', ()=>{ pathInput.value=''; csvInput.value=''; thead.innerHTML=''; tbody.innerHTML=''; table.style.display='none'; pager.style.display='none'; parsedData=null; rows=[]; filteredRows=[]; });
                        csvInput.addEventListener('change', e=>{ const f = e.target.files && e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ev=>{ const parsed = parseCSV(ev.target.result); initializeTable(parsed); }; reader.readAsText(f); });

                        exportBtn.addEventListener('click', ()=>{ if(!parsedData){ alert('No data'); return; } const hdrs = parsedData.headers.slice(); const out = filteredRows.map(r=> hdrs.map((h,c)=>{ const v = r[c]!=null? String(r[c]) : ''; if(columnDerivedValueFuncs[c]){ const n = columnDerivedValueFuncs[c](v); return isNaN(n)? '' : String(n); } if(columnIsNumeric[c]) return v.replace(/,/g,''); return v; })); const csv = Papa.unparse({ fields: hdrs, data: out }); const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='stats-export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });

                        pageSizeSelect.addEventListener('change', ()=>{ pageSize = Number(pageSizeSelect.value)||25; pageIdx=0; renderPage(); });
                        prevBtn.addEventListener('click', ()=>{ if(pageIdx>0){ pageIdx--; renderPage(); }});
                        nextBtn.addEventListener('click', ()=>{ const tp = Math.max(1, Math.ceil(filteredRows.length/pageSize)); if(pageIdx<tp-1){ pageIdx++; renderPage(); }});

                        document.addEventListener('DOMContentLoaded', ()=>{ const active = document.querySelector('.nav-tab.active'); if(active && active.getAttribute('data-tab')==='stats'){ const p = pathInput.value && pathInput.value.trim(); if(p) fetchAndLoad(p); } });
                        window.loadStatsTab = function(){ if(parsedData && parsedData.headers && parsedData.headers.length) return; const p = pathInput.value && pathInput.value.trim(); if(p) fetchAndLoad(p); };
                    })();
                </script>
            </div>
        </section>
            </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <ul class="footer-links">
                    <li><a href="https://www.discord.gg/57teqfx9Yg">Join the Discord</a></li>
                    <li><a href="terms-of-service.html" class="nav-link">Terms of Service</a></li>
                    <li><a href="privacy-policy.html" class="nav-link">Privacy Policy</a></li>
                    <li><a href="https://coff.ee/devpringle">Support The Site</a></li>
                </ul>
                <div class="footer-note">
                    <p>Original concept by Hypnotik  Created by pringle</p>
                    <p>This website is not affiliated with Wargaming.net or World of Tanks</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let playersData = [];
        let teamsData = [];
        let userRosters = { 1: [], 2: [], 3: [] };
        let currentMatchDay = 1;
        let maxRosterSize = 7;
        let isAuthenticated = false;
        let dataLoaded = false;

        var api;

        const DISCORD_SERVER_ID = '1382054719102390354'; 
        const DISCORD_INVITE_CODE = '57teqfx9Yg';

        function initializeDiscordWidget() {
            const iframe = document.getElementById('discordWidgetIframe');
            if (!iframe) return;

            const serverId = (typeof window.DISCORD_SERVER_ID === 'string' && window.DISCORD_SERVER_ID.trim())
                ? window.DISCORD_SERVER_ID.trim()
                : (typeof DISCORD_SERVER_ID === 'string' && DISCORD_SERVER_ID.trim() ? DISCORD_SERVER_ID.trim() : null);

            if (serverId) {
                iframe.src = `https://discord.com/widget?id=${serverId}&theme=dark`;
                iframe.setAttribute('sandbox', 'allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts');
            }

            const joinBtns = document.querySelectorAll('.discord-join-btn');
            joinBtns.forEach(btn => {
                const current = btn.getAttribute('href') || '';
                if (!/discord\.gg/.test(current)) {
                    btn.href = DISCORD_INVITE_CODE ? `https://discord.gg/${DISCORD_INVITE_CODE}` : 'https://discord.com/invite';
                }
            });
        }

        function positionDiscordSidebar() {
            const sidebar = document.querySelector('.discord-sidebar');
            const container = document.querySelector('.container');
            if (!sidebar || !container) return;


            let baseWidth = sidebar.dataset.baseWidth ? parseFloat(sidebar.dataset.baseWidth) : 0;
            if (!baseWidth || isNaN(baseWidth)) {
                baseWidth = sidebar.offsetWidth || 300;
                sidebar.dataset.baseWidth = String(baseWidth);
            }

            const rect = container.getBoundingClientRect();
            const vw = window.innerWidth || document.documentElement.clientWidth || 1920;

            const gutter = vw >= 1800 ? 48 : vw >= 1600 ? 40 : vw >= 1366 ? 28 : 20;
            const edgePad = 12;
            const minScale = 0.85;

            const available = rect.left - gutter - edgePad;

            let scale = 1;
            if (available < baseWidth) {
                scale = Math.max(minScale, available / baseWidth);
            }

            if (available < baseWidth * minScale - 1) {
                sidebar.style.display = 'none';
                return;
            }

            sidebar.style.display = '';

            const scaledWidth = baseWidth * scale;
            const left = Math.round(rect.left - scaledWidth - gutter);
            sidebar.style.left = left + 'px';
            sidebar.style.transform = `translateY(-50%) scale(${scale})`;
        }

    // Tournament configuration
        const tournamentConfig = {
            totalMatchDays: 3,
            rosterCutoffs: {
                1: new Date('2025-09-20T00:00:00Z'),
                2: new Date('2025-09-21T00:00:00Z'),
                3: new Date('2025-09-22T00:00:00Z')
            }
        };

                // Match schedule data with UTC timestamps
        const matchSchedule = {
            day1: [
                {
                    utcTime: '2025-09-20T00:00:00Z', // 10:00 AM EST = 15:00 UTC
                    teams: ['TEAM', 'Dogs'],
                    round: 'Groups - Round 1',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 11:15 AM EST = 16:15 UTC
                    teams: ['Team Bye', 'Gym Class'],
                    round: 'Groups - Round 1',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 12:30 PM EST = 17:30 UTC
                    teams: ['ANIMAL CONTROL', 'Banana'],
                    round: 'Groups - Round 1',
                    seriesLength: 'BO5',
                    status: 'Final (3-0)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Underdogs', 'BASED'],
                    round: 'Groups - Round 1',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'Dogs'],
                    round: 'Groups - Round 2',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['TEAM', 'GYM CLASS'],
                    round: 'Groups - Round 2',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Team Bye', 'ANIMAL CONTROL'],
                    round: 'Groups - Round 2',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Underdogs', 'Banana'],
                    round: 'Groups - Round 2',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Underdogs', 'Team Bye'],
                    round: 'Groups - Round 3',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['TEAM', 'ANIMAL CONTROL'],
                    round: 'Groups - Round 3',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Dogs', 'GYM CLASS'],
                    round: 'Groups - Round 3',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'BASED'],
                    round: 'Groups - Round 3',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['TEAM', 'Underdogs'],
                    round: 'Groups - Round 4',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Dogs', 'ANIMAL CONTROL'],
                    round: 'Groups - Round 4',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                }, 
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['BASED', 'Banana'],
                    round: 'Groups - Round 4',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-20T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'GYM CLASS'],
                    round: 'Groups - Round 4',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                }
            ],
            day2: [
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['GYM CLASS', 'ANIMAL CONTROL'],
                    round: 'Groups - Round 5',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Dogs', 'Underdogs'],
                    round: 'Groups - Round 5',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['BASED', 'Team Bye'],
                    round: 'Groups - Round 5',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'Banana'],
                    round: 'Groups - Round 5',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'ANIMAL CONTROL'],
                    round: 'Groups - Round 6',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['GYM CLASS', 'Underdogs'],
                    round: 'Groups - Round 6',
                    seriesLength: 'BO5',
                    status: 'Final (3-0)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['BASED', 'TEAM'],
                    round: 'Groups - Round 6',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Banana', 'Team Bye'],
                    round: 'Groups - Round 6',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['ANIMAL CONTROL', 'Underdogs'],
                    round: 'Groups - Round 7',
                    seriesLength: 'BO5',
                    status: 'Final (3-0)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['BASED', 'Dogs'],
                    round: 'Groups - Round 7',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Banana', 'TEAM'],
                    round: 'Groups - Round 7',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'Team Bye'],
                    round: 'Groups - Round 7',
                    seriesLength: 'BO5',
                    status: 'Final (2-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['GYM CLASS', 'BASED'],
                    round: 'Groups - Round 8',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Banana', 'Dogs'],
                    round: 'Groups - Round 8',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Team Bye', 'TEAM'],
                    round: 'Groups - Round 8',
                    seriesLength: 'BO5',
                    status: 'Final (0-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'Underdogs'],
                    round: 'Groups - Round 8',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Banana', 'GYM CLASS'],
                    round: 'Groups - Round 9',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['ANIMAL CONTROL', 'BASED'],
                    round: 'Groups - Round 9',
                    seriesLength: 'BO5',
                    status: 'Final (3-1)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Team Bye', 'Dogs'],
                    round: 'Groups - Round 9',
                    seriesLength: 'BO5',
                    status: 'Final (1-3)',
                    statusClass: 'completed'
                },
                {
                    utcTime: '2025-09-21T00:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Bridge', 'TEAM'],
                    round: 'Groups - Round 9',
                    seriesLength: 'BO5',
                    status: 'Final (3-2)',
                    statusClass: 'completed'
                }
            ],
            day3: [
                {
                    utcTime: '2025-09-21T23:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['ANIMAL CONTROL', 'Bridge'],
                    round: 'Semifinals',
                    seriesLength: 'BO7',
                    status: 'TBD',
                    statusClass: 'upcoming'
                },
                {
                    utcTime: '2025-09-21T23:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['Dogs', 'GYM CLASS ZEROS'],
                    round: 'Semifinals',
                    seriesLength: 'BO7',
                    status: 'TBD',
                    statusClass: 'upcoming'
                },
                {
                    utcTime: '2025-09-21T23:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['TBD', 'TBD'],
                    round: 'Third Place Match',
                    seriesLength: 'BO7',
                    status: 'TBD',
                    statusClass: 'upcoming'
                },
                {
                    utcTime: '2025-09-21T23:00:00Z', // 1:45 PM EST = 18:45 UTC
                    teams: ['TBD', 'TBD'],
                    round: 'Grand Final',
                    seriesLength: 'BO9',
                    status: 'TBD',
                    statusClass: 'upcoming'
                }
            ]
        }


        function formatLocalTime(utcTimeString) {
            if (utcTimeString === 'TBD') {
                return 'TBD';
            }
            
            const date = new Date(utcTimeString);
            const options = {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true,
                timeZoneName: 'short'
            };
            return date.toLocaleTimeString([], options);
        }

        // Function to get user's timezone
        function getUserTimezone() {
            return Intl.DateTimeFormat().resolvedOptions().timeZone;
        }

        // Function to render matches for a day
        function renderMatches(dayKey, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const matches = matchSchedule[dayKey];
            if (!matches || !Array.isArray(matches) || matches.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = matches.map(match => `
                <tr>
                    <td style="font-weight: 600; color: #00d4ff;">${formatLocalTime(match.utcTime)}</td>
                    <td>
                        <span class="team-name">${match.teams[0]}</span> vs 
                        <span class="team-name">${match.teams[1]}</span>
                    </td>
                    <td>${match.round}</td>
                    <td><span class="series-length">${match.seriesLength}</span></td>
                    <td><span class="match-status ${match.statusClass}">${match.status}</span></td>
                </tr>
            `).join('');
        }

        function initializeLocalTimeDisplay() {
            if (typeof matchSchedule === 'undefined') { return; }
            if (document.getElementById('day1-matches')) renderMatches('day1', 'day1-matches');
            if (document.getElementById('day2-matches')) renderMatches('day2', 'day2-matches');
            if (document.getElementById('day3-matches')) renderMatches('day3', 'day3-matches');
        }
        
        // Tab Navigation System
        function initializeTabNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            
            navTabs.forEach((tab) => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetTab = this.dataset.tab;
                    

                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
 
                    this.classList.add('active');
                    
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        handleTabSpecificLogic(targetTab);
                    }
                });
            });
        }

        function handleTabSpecificLogic(targetTab) {
            switch(targetTab) {
                case 'standings':
                    loadFantasyLeaderboard();
                    break;
                case 'stats':
                  
                    if (window.loadStatsTab && typeof window.loadStatsTab === 'function') {
                        try { window.loadStatsTab(); } catch (e) { /* ignore */ }
                    }
                    break;
                case 'players':
                    if (dataLoaded) {
                        updateRosterDisplay();
                        populatePlayersTable();
                    }
                    break;
            }
        }

        // Auth functions
        function redirectToLogin() {
            window.location.href = 'login.html?return=' + encodeURIComponent(window.location.href);
        }

        function handleLogout() {
            if (window.api && typeof window.api.logout === 'function') {
                window.api.logout();
            }
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function updateAuthUI() {
            const signInBtn = document.getElementById('signInBtn');
            const userMenu = document.getElementById('userMenu');
            const authOverlay = document.getElementById('authOverlay');
            
            const hasApi = window.api && typeof window.api.isAuthenticated === 'function';
            if (hasApi && window.api.isAuthenticated()) {
                isAuthenticated = true;
                const user = window.api.getCurrentUser();
                
                signInBtn.style.display = 'none';
                userMenu.style.display = 'block';
                document.getElementById('username').textContent = user?.username || '';
                if (authOverlay) authOverlay.style.display = 'none';
                
                loadAllUserRosters();
            } else {
                isAuthenticated = false;
                signInBtn.style.display = 'block';
                userMenu.style.display = 'none';
                if (authOverlay) authOverlay.style.display = 'flex';
                
                loadRostersFromLocalStorage();
                updateRosterDisplay();
            }
        }

        // Match day functions
        function isMatchDayLocked(matchDay) {
            const now = new Date();
            const cutoff = tournamentConfig.rosterCutoffs[matchDay];
            return cutoff && now >= cutoff;
        }

        function getActiveMatchDay() {
            for (let i = 1; i <= tournamentConfig.totalMatchDays; i++) {
                if (!isMatchDayLocked(i)) return i;
            }
            return 1;
        }

        function initializeMatchDayTabs() {
            const tabs = document.querySelectorAll('.match-day-tab');
            
            tabs.forEach(tab => {
                const matchDay = parseInt(tab.dataset.matchDay);
                tab.onclick = () => switchMatchDay(matchDay);
                if (isMatchDayLocked(matchDay)) {
                    tab.classList.add('locked');
                    tab.title = 'Roster deadline has passed';
                } else {
                    tab.classList.remove('locked');
                    tab.title = '';
                }
            });
        }

        function switchMatchDay(matchDay) {
            currentMatchDay = matchDay;
            updateMatchDayUI();
            updateRosterDisplay();
            populatePlayersTable();
        }

        function updateMatchDayUI() {
            document.querySelectorAll('.match-day-tab').forEach(tab => {
                tab.classList.remove('active');
                if (parseInt(tab.dataset.matchDay) === currentMatchDay) {
                    tab.classList.add('active');
                }
            });

            document.getElementById('currentMatchDayDisplay').textContent = `(Match Day ${currentMatchDay})`;
            document.getElementById('sidebarMatchDay').textContent = currentMatchDay;
            updateRosterStatusIndicator();
        }

        function updateRosterStatusIndicator() {
            const currentRoster = getCurrentRoster();
            const statusDot = document.getElementById('currentRosterStatusDot');
            const statusText = document.getElementById('currentRosterStatusText');

            if (!statusDot || !statusText) return;

            if (currentRoster.length === 0) {
                statusDot.className = 'roster-status-dot empty';
                statusText.textContent = 'No roster set';
            } else if (currentRoster.length < maxRosterSize) {
                statusDot.className = 'roster-status-dot incomplete';
                statusText.textContent = `${currentRoster.length}/${maxRosterSize} players`;
            } else {
                statusDot.className = 'roster-status-dot';
                statusText.textContent = 'Roster complete';
            }
        }

        // Roster functions
        function getCurrentRoster() {
            return userRosters[currentMatchDay] || [];
        }

        function setCurrentRoster(roster) {
            userRosters[currentMatchDay] = [...roster];
        }

        async function loadAllUserRosters() {
            if (!api.isAuthenticated()) {
                loadRostersFromLocalStorage();
                return;
            }
            
            try {
                for (let i = 1; i <= tournamentConfig.totalMatchDays; i++) {
                    userRosters[i] = [];
                }
                
                for (let matchDay = 1; matchDay <= tournamentConfig.totalMatchDays; matchDay++) {
                    try {
                        const response = await api.getRoster('draft-cup-sept-2025', matchDay);
                        if (response && response.roster && response.roster.length > 0) {
                            userRosters[matchDay] = response.roster;
                        }
                    } catch (error) {
                        console.log(`Error loading Match Day ${matchDay} roster:`, error.message);
                    }
                }
            } catch (error) {
                console.error('Error loading user rosters:', error);
                loadRostersFromLocalStorage();
            }
            
            updateRosterDisplay();
            updateRosterStatusIndicator();
        }

        function loadRostersFromLocalStorage() {
            for (let i = 1; i <= tournamentConfig.totalMatchDays; i++) {
                let saved = localStorage.getItem(`roster_draft-cup-sept-2025_md${i}_demo`);
                
                if (!saved && i === 1) {
                    saved = localStorage.getItem(`roster_draft-cup-sept-2025_demo`);
                    if (saved) {
                        localStorage.setItem(`roster_draft-cup-sept-2025_md1_demo`, saved);
                    }
                }
                
                if (saved) {
                    try {
                        userRosters[i] = JSON.parse(saved);
                    } catch (error) {
                        console.error(`Error parsing saved roster for match day ${i}:`, error);
                        userRosters[i] = [];
                    }
                } else {
                    userRosters[i] = [];
                }
            }
        }

        async function saveCurrentRoster() {
            if (!isAuthenticated) return;

            const currentRoster = getCurrentRoster();
            
            try {
                await api.saveRoster('draft-cup-sept-2025', currentRoster, currentMatchDay);
            } catch (error) {
                console.error('Error saving roster:', error);
                const localKey = `roster_draft-cup-sept-2025_md${currentMatchDay}_demo`;
                localStorage.setItem(localKey, JSON.stringify(currentRoster));
            }
        }

        // Fantasy Leaderboard Functions
        async function loadFantasyLeaderboard() {
            const loadingState = document.getElementById('standingsLoadingState');
            const standingsTable = document.getElementById('fantasyStandingsTable');
        
            if (!loadingState) return;
        
            loadingState.style.display = 'block';
            standingsTable.style.display = 'none';
        
            try {
                const bracketFilter = document.getElementById('standingsBracketFilter');
                const matchDayFilter = document.getElementById('standingsMatchDayFilter')?.value || '';

                // determine view and whether to show the Days column
                const view = bracketFilter ? bracketFilter.value : '';
                const showDays = !(view === 'match-day');

                // hide/show header cell for Days to match rows
                const daysHeader = document.getElementById('daysColumnHeader');
                if (daysHeader) daysHeader.style.display = showDays ? '' : 'none';

                const response = await api.getLeaderboard('draft-cup-sept-2025', matchDayFilter || null);

                loadingState.style.display = 'none';
                standingsTable.style.display = 'table';
                
                const tbody = document.getElementById('fantasyStandingsTableBody');
                if (tbody && response.leaderboard) {
                    if (showDays) {
                        tbody.innerHTML = response.leaderboard.map(entry => `
                            <tr>
                                <td class="rank-cell">${entry.rank}</td>
                                <td class="username-cell">${entry.username}</td>
                                <td class="score-cell">${entry.total_points}</td>
                                <td>${entry.avg_points}</td>
                                <td>${entry.match_days_played}</td>
                            </tr>
                        `).join('');
                    } else {
                        // single match-day view
                        tbody.innerHTML = response.leaderboard.map(entry => `
                            <tr>
                                <td class="rank-cell">${entry.rank}</td>
                                <td class="username-cell">${entry.username}</td>
                                <td class="score-cell">${entry.total_points}</td>
                                <td>${entry.avg_points}</td>
                            </tr>
                        `).join('');
                    }
                }
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                loadingState.style.display = 'none';
                
                const tbody = document.getElementById('fantasyStandingsTableBody');
                if (tbody) {
                    // match colspan to whether Days column is visible
                    const bracketFilter = document.getElementById('standingsBracketFilter');
                    const view = bracketFilter ? bracketFilter.value : '';
                    const colspan = (view === 'match-day') ? 4 : 5;

                    tbody.innerHTML = `
                        <tr>
                            <td colspan="${colspan}" style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.6);">
                                <div style="font-size: 1.2rem; margin-bottom: 1rem;"> No Leaderboard Data</div>
                                <div>No fantasy scores available yet. Player performance data needs to be added to calculate standings.</div>
                            </td>
                        </tr>
                    `;
                }
                standingsTable.style.display = 'table';
            }
        }

        // Player table functions
        async function loadPlayersData() {
            try {
                const response = await api.getPlayers('draft-cup-sept-2025');
                
                if (response && response.players && response.players.length > 0) {
                    playersData = response.players.map(player => ({
                        name: player.player_name,
                        team: player.team_name,
                        battles: player.battles_played || '0%',
                        points: player.total_points || 0,
                        avg: player.average_points || 0,
                        picked: player.picked_percentage || '0%'
                    }));
                } else {
                    playersData = getFallbackPlayers();
                }
            } catch (error) {
                console.error('Error loading players:', error);
                playersData = getFallbackPlayers();
            }
            
            populatePlayersTable();
        }

        function populatePlayersTable() {
            const tbody = document.getElementById('playersTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (playersData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.6);">
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;"> No Players Found</div>
                        <div>Either the database is empty or there's a connection issue.</div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }

            const teamFilter = document.getElementById('teamFilter');
            const selectedTeam = teamFilter ? teamFilter.value : '';
            const filteredPlayers = selectedTeam ? 
                  playersData.filter(p => p.team === selectedTeam) : 
                  playersData;

            const currentRoster = getCurrentRoster();

            filteredPlayers.forEach(player => {
                const row = document.createElement('tr');
                
                let actionIcon = 'lock';
                let actionClass = '';
                let actionTitle = 'Rosters are locked';
                
                if (!isAuthenticated) {
                    actionIcon = 'lock';
                    actionClass = '';
                    actionTitle = 'Please sign in to add players';
                } else if (!isMatchDayLocked(currentMatchDay)) {
                    if (currentRoster.includes(player.name)) {
                        actionIcon = 'remove';
                        actionClass = 'remove';
                        actionTitle = 'Remove from roster';
                    } else if (currentRoster.length < maxRosterSize) {
                        actionIcon = 'add';
                        actionClass = 'add';
                        actionTitle = 'Add to roster';
                    } else {
                        actionIcon = 'lock';
                        actionClass = '';
                        actionTitle = 'Roster is full';
                    }
                } else {
                    actionIcon = 'lock';
                    actionClass = '';
                    actionTitle = `Match Day ${currentMatchDay} deadline has passed`;
                }

                row.innerHTML = `
                    <td class="action-column">
                        <button class="player-action-btn ${actionClass}" 
                                data-player="${player.name}" 
                                title="${actionTitle}">
                            <span class="material-icons">${actionIcon}</span>
                        </button>
                    </td>
                    <td class="player-name">${player.name}</td>
                    <td class="player-team">${player.team}</td>
                    <td class="player-battles">${player.battles}</td>
                    <td class="player-points">${parseFloat(player.points).toLocaleString()}</td>
                    <td class="player-avg">${player.avg}</td>
                    <td class="player-picked">${player.picked}</td>
                `;
                
                tbody.appendChild(row);
            });

            document.querySelectorAll('.player-action-btn').forEach(btn => {
                btn.addEventListener('click', handlePlayerAction);
            });
        }

        function handlePlayerAction(e) {
            const playerName = e.currentTarget.dataset.player;
            const button = e.currentTarget;
            
            if (!isAuthenticated) {
                showNotification('Please sign in to manage your roster', 'error');
                return;
            }
            
            if (isMatchDayLocked(currentMatchDay)) {
                showNotification(`Match Day ${currentMatchDay} roster deadline has passed`, 'error');
                return;
            }
            
            if (button.classList.contains('add')) {
                addPlayerToRoster(playerName);
            } else if (button.classList.contains('remove')) {
                removePlayerFromRoster(playerName);
            }
        }

        function addPlayerToRoster(playerName) {
            if (!isAuthenticated) {
                showNotification('Please sign in to add players to your roster', 'error');
                return;
            }

            const currentRoster = getCurrentRoster();

            if (currentRoster.length >= maxRosterSize) {
                showNotification(`Roster is full (${maxRosterSize} players maximum)`, 'error');
                return;
            }
            
            if (currentRoster.includes(playerName)) {
                showNotification('Player is already in your roster', 'error');
                return;
            }
            
            currentRoster.push(playerName);
            setCurrentRoster(currentRoster);
            updateRosterDisplay();
            populatePlayersTable();
            saveCurrentRoster();
            
            showNotification(`${playerName} added to Match Day ${currentMatchDay} roster`, 'success');
        }

        function removePlayerFromRoster(playerName) {
            if (!isAuthenticated) {
                showNotification('Please sign in to manage your roster', 'error');
                return;
            }

            const currentRoster = getCurrentRoster();
            const index = currentRoster.indexOf(playerName);
            
            if (index > -1) {
                currentRoster.splice(index, 1);
                setCurrentRoster(currentRoster);
                updateRosterDisplay();
                populatePlayersTable();
                saveCurrentRoster();
                
                showNotification(`${playerName} removed from Match Day ${currentMatchDay} roster`, 'success');
            }
        }

        function updateRosterDisplay() {
            const rosterCount = document.getElementById('rosterCount');
            const rosterList = document.getElementById('rosterList');
            const rosterMessage = document.getElementById('rosterMessage');
            
            if (!rosterCount) return;
            
            const currentRoster = getCurrentRoster();
            rosterCount.textContent = currentRoster.length;
            
            if (isAuthenticated && !isMatchDayLocked(currentMatchDay) && currentRoster.length > 0) {
                if (rosterMessage) rosterMessage.style.display = 'none';
                if (rosterList) {
                    rosterList.style.display = 'block';
                    rosterList.innerHTML = currentRoster.map(playerName => `
                        <div class="roster-player">
                            <span class="roster-player-name">${playerName}</span>
                            <button class="roster-player-remove" 
                                    onclick="removePlayerFromRoster('${playerName}')"
                                    title="Remove player">
                                <span class="material-icons" style="font-size: 1rem;">close</span>
                            </button>
                        </div>
                    `).join('');
                }
            } else {
                if (rosterMessage) {
                    rosterMessage.style.display = 'block';
                    if (!isAuthenticated) {
                        rosterMessage.innerHTML = `Your roster is empty. Add players from the table above to build your fantasy team for Match Day ${currentMatchDay}.`;
                    } else if (isMatchDayLocked(currentMatchDay)) {
                        rosterMessage.innerHTML = `
                            Match Day ${currentMatchDay} roster deadline has passed.
                            <br><br>
                            You can still set rosters for future match days using the tabs above.
                        `;
                    } else {
                        rosterMessage.innerHTML = `Your roster is empty. Add players from the table above to build your fantasy team for Match Day ${currentMatchDay}.`;
                    }
                }
                if (rosterList) rosterList.style.display = 'none';
            }

            updateRosterStatusIndicator();
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : 'error'}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">
                    <span class="material-icons">close</span>
                </button>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                background: ${type === 'success' ? 'rgba(34, 197, 94, 0.9)' : 'rgba(239, 68, 68, 0.9)'};
                color: white;
                padding: 1rem;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        function updateEventLogoSize() {
            const titleEl = document.getElementById('tournamentTitle');
            const statusEl = document.getElementById('statusHeader');
            const logoImg = document.getElementById('eventLogo');
            if (!titleEl || !statusEl || !logoImg) return;
            const titleRect = titleEl.getBoundingClientRect();
            const statusRect = statusEl.getBoundingClientRect();
            const height = Math.max(80, Math.round(statusRect.bottom - titleRect.top));
            logoImg.style.height = height + 'px';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Tournament page loading...');

            // Initialize Discord embed
            try { initializeDiscordWidget(); } catch (e) { console.warn('Discord widget init error:', e); }
            try { positionDiscordSidebar(); window.addEventListener('resize', positionDiscordSidebar); } catch (e) { console.warn('Discord sidebar position error:', e); }
            try {
                const statusEl = document.getElementById('discordWidgetStatus');
                if (statusEl) {
                    statusEl.textContent = 'Checking Discord widget';
                    fetch('https://discord.com/api/guilds/1382054719102390354/widget.json', { cache: 'no-store' })
                        .then(async (r) => {
                            if (!r.ok) {
                                const text = await r.text().catch(() => '');
                                throw new Error(`HTTP ${r.status} ${text || ''}`);
                            }
                            return r.json();
                        })
                        .then((data) => {
                            if (data && typeof data.presence_count !== 'undefined') {
                                statusEl.textContent = `Online: ${data.presence_count}`;
                            } else {
                                statusEl.textContent = 'Discord widget enabled, awaiting presence data';
                            }
                        })
                        .catch((err) => {
                            statusEl.innerHTML = 'Discord widget not returning member data. Ensure Server Settings  Widget is enabled and an invite channel is selected.';
                            console.warn('Widget JSON fetch failed:', err);
                        });
                }
            } catch (e) { console.warn('Widget status probe error:', e); }

            // global API client for auth/UI logic
            if (typeof FantasyAPI !== 'undefined' && !window.api) {
                window.api = new FantasyAPI();
            }
            api = window.api;

            initializeLocalTimeDisplay();
                        
            const scheduleTab = document.querySelector('[data-tab="schedule"]');
            if (scheduleTab) {
                scheduleTab.addEventListener('click', function() {
                    setTimeout(initializeLocalTimeDisplay, 100);
                });
            }
            
            try {
                // Initialize basic components
                currentMatchDay = getActiveMatchDay();
                updateAuthUI();
                initializeTabNavigation();
                initializeMatchDayTabs();
                updateMatchDayUI();
                
                // Loads data from backend
                await loadPlayersData();
                dataLoaded = true;
                
                // Updates displays
                updateRosterDisplay();
                
                // Adds table sorting
                document.querySelectorAll('.players-table .sortable').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.dataset.sort;
                        const currentDirection = th.classList.contains('asc') ? 'desc' : 'asc';
                        
                        document.querySelectorAll('.players-table .sortable').forEach(header => {
                            header.classList.remove('asc', 'desc');
                        });
                        
                        th.classList.add(currentDirection);
                        sortTable(column, currentDirection);
                    });
                });
                
                // Adds filter functionality
                const teamFilter = document.getElementById('teamFilter');
                if (teamFilter) {
                    teamFilter.addEventListener('change', () => {
                        populatePlayersTable();
                    });
                }

                // Button actions
                document.querySelectorAll('.action-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (this.textContent.includes('Set My Roster')) {
                            if (!isAuthenticated) {
                                showNotification('Please sign in to set your roster', 'error');
                                return;
                            }
                            const playersTab = document.querySelector('[data-tab="players"]');
                            if (playersTab) {
                                playersTab.click();
                            }
                        }
                    });
                });

                // Close dropdown listener
                document.addEventListener('click', (e) => {
                    const userMenu = document.getElementById('userMenu');
                    if (userMenu && !userMenu.contains(e.target)) {
                        document.getElementById('userDropdown').classList.remove('show');
                    }
                });

                const matchDayFilter = document.getElementById('standingsMatchDayFilter');
                if (matchDayFilter) {
                    matchDayFilter.addEventListener('change', () => {
                        loadFantasyLeaderboard();
                    });
                }
                const bracketFilter = document.getElementById('standingsBracketFilter');
                if (bracketFilter) {
                    bracketFilter.addEventListener('change', () => {
                    
                        loadFantasyLeaderboard();
                    });
                }
                
                console.log('Tournament page fully loaded!');
                updateEventLogoSize();
                window.addEventListener('resize', updateEventLogoSize);
                
            } catch (error) {
                console.error('Error during page initialization:', error);
            }
        });

        function sortTable(column, direction) {
            playersData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (column === 'points' || column === 'avg') {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                } else if (column === 'picked' || column === 'battles') {
                    aVal = parseFloat(aVal.replace('%', ''));
                    bVal = parseFloat(bVal.replace('%', ''));
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            populatePlayersTable();
        }

        // Make functions globally accessible
        window.loadFantasyLeaderboard = loadFantasyLeaderboard;
        window.removePlayerFromRoster = removePlayerFromRoster;
        window.toggleUserDropdown = toggleUserDropdown;
        window.handleLogout = handleLogout;
        window.redirectToLogin = redirectToLogin;
    </script>
    
        <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Function to extract the tournament ID from the filename
            function getTournamentIdFromUrl() {
                const pathSegments = window.location.pathname.split('/');
                const filename = pathSegments[pathSegments.length - 1];
                return filename.replace('.html', '');
            }

            const tournamentId = getTournamentIdFromUrl();
            const detailsApi = window.api || (typeof FantasyAPI !== 'undefined' ? new FantasyAPI() : null);

            async function fetchAndRenderTournamentData(id) {
                try {
                    const tournamentData = await detailsApi.getTournamentDetails(id);
                    console.log('Fetched data:', tournamentData);

                    // title and tournament name with data
                    document.title = `${tournamentData.tournament_name} - WoT Fantasy`;
                    document.querySelector('.tournament-name').textContent = tournamentData.tournament_name;
                    

                } catch (error) {
                    console.error('Error fetching tournament data:', error);
                    // Handle the error
                    document.querySelector('.tournament-name').textContent = "Tournament Not Found";
                }
            }

            if (tournamentId && detailsApi) {
                fetchAndRenderTournamentData(tournamentId);
            } else if (!detailsApi) {
                console.error("API client not available; skipping details fetch.");
            } else {
                console.error("Could not determine tournament ID from URL.");
            }
        });
    </script>
</body>
</html>
